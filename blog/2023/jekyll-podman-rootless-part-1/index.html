<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title>Running Jekyll in a Rootless Podman Container: Part 1 - Setting the Stage | Allehanda</title> <meta name="author" content="Carl Johan Rehn"> <meta name="description" content="A guide on setting up and running Jekyll in a rootless Podman container. We explore the importance of user mapping and file ownership when using rootless containers."> <meta name="keywords" content="jekyll, jekyll-theme, academic-website, portfolio-website"> <link rel="stylesheet" href="/allehanda/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="https://unpkg.com/bootstrap-table@1.22.1/dist/bootstrap-table.min.css"> <link rel="stylesheet" href="/allehanda/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons"> <link rel="stylesheet" href="/allehanda/assets/css/jekyll-pygments-themes-github.css?19f3075a2d19613090fe9e16b564e1fe" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="data:image/svg+xml,&lt;svg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20100%20100%22&gt;&lt;text%20y=%22.9em%22%20font-size=%2290%22&gt;%E2%9A%9B%EF%B8%8F&lt;/text&gt;&lt;/svg&gt;"> <link rel="stylesheet" href="/allehanda/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://carljohanrehn.github.io/allehanda/blog/2023/jekyll-podman-rootless-part-1/"> <link rel="stylesheet" href="/allehanda/assets/css/jekyll-pygments-themes-native.css?e74e74bf055e5729d44a7d031a5ca6a5" media="none" id="highlight_theme_dark"> <script src="/allehanda/assets/js/theme.js?2ed62375d27d1acd85fb25a8d933282f"></script> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/allehanda/">Allehanda</a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/allehanda/">about</a> </li> <li class="nav-item "> <a class="nav-link" href="/allehanda/blog/">blog</a> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="fa-solid fa-moon"></i> <i class="fa-solid fa-sun"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5"> <div class="post"> <header class="post-header"> <h1 class="post-title">Running Jekyll in a Rootless Podman Container: Part 1 - Setting the Stage</h1> <p class="post-meta"> April 15, 2023 </p> <p class="post-tags"> <a href="/allehanda/blog/2023"> <i class="fa-solid fa-calendar fa-sm"></i> 2023 </a>   ·   <a href="/allehanda/blog/tag/jekyll"> <i class="fa-solid fa-hashtag fa-sm"></i> Jekyll,</a>   <a href="/allehanda/blog/tag/podman"> <i class="fa-solid fa-hashtag fa-sm"></i> Podman,</a>   <a href="/allehanda/blog/tag/containers"> <i class="fa-solid fa-hashtag fa-sm"></i> Containers,</a>   <a href="/allehanda/blog/tag/rootless"> <i class="fa-solid fa-hashtag fa-sm"></i> Rootless,</a>   <a href="/allehanda/blog/tag/development"> <i class="fa-solid fa-hashtag fa-sm"></i> Development</a>     ·   <a href="/allehanda/blog/category/fries-al-folio"> <i class="fa-solid fa-tag fa-sm"></i> fries-al-folio</a>   </p> </header> <article class="post-content"> <div id="markdown-content"> <hr> <p>In this first part of a two part series, we’ll explore how to run Jekyll, a static site generator, inside a rootless Podman container. This approach enhances security and allows for more streamlined development workflows. We’ll cover user mapping, file ownership, and how to run Jekyll with <code class="language-plaintext highlighter-rouge">podman-compose</code>.</p> <p>This post will guide you through these steps, making use of the following folder:</p> <div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>~/my-pak/cross-python-development/torch-app-docker/jekyll/docker/fries-al-folio/
</code></pre></div></div> <p>The file to examine is named: <code class="language-plaintext highlighter-rouge">README-jekyll-podman-rootless</code>.</p> <h2 id="building-the-jekyll-image">Building the Jekyll Image</h2> <p>First, we need to create a container image that includes Jekyll. The image itself is built from the following <code class="language-plaintext highlighter-rouge">Containerfile</code> : <code class="language-plaintext highlighter-rouge">Containerfile-pypak-jekyll-srv</code>. You can open it with your favorite editor:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>emacs Containerfile-pypak-jekyll-srv
</code></pre></div></div> <p>Once you have examined it, we can build the image with Podman using the <code class="language-plaintext highlighter-rouge">build</code> command:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>podman image build <span class="nt">--no-cache</span> <span class="nt">--format</span> docker <span class="nt">-f</span> Containerfile-pypak-jekyll-srv <span class="nt">-t</span> pypak-jekyll-srv <span class="nb">.</span>
</code></pre></div></div> <p>This command will create a Docker-formatted image named <code class="language-plaintext highlighter-rouge">pypak-jekyll-srv</code> that we will use later.</p> <h2 id="understanding-file-ownership-in-rootless-containers">Understanding File Ownership in Rootless Containers</h2> <p>Before we can run a rootless container, we must address an important detail: file ownership. Let’s see who owns the files on our host by running:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">ls</span> <span class="nt">-al</span>
</code></pre></div></div> <p>You should see something like this:</p> <div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>drwxr-xr-x. 1 alpha alpha  1700 Apr 29 09:34  .
drwxr-xr-x. 1 alpha alpha   190 Mar 18 10:38  ..
-rw-r--r--. 1 alpha alpha   243 Feb  7 17:08  404.html
-rw-r--r--. 1 alpha alpha  1390 Feb  7 17:08  .all-contributorsrc
drwxr-xr-x. 1 alpha alpha    58 Feb  7 17:08  assets
drwxr-xr-x. 1 alpha alpha    20 Feb  7 17:08  _bibliography
drwxr-xr-x. 1 alpha alpha   126 Feb  7 17:08  bin
drwxr-xr-x. 1 alpha alpha    20 Feb  7 17:08  blog
</code></pre></div></div> <p>As expected, our user, <em>alpha</em>, owns these files.</p> <p>Now, let’s use <code class="language-plaintext highlighter-rouge">podman unshare</code> to see who owns the files inside the container when we run it.</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>podman unshare <span class="nb">ls</span> <span class="nt">-al</span>
</code></pre></div></div> <p>The output will look like this:</p> <div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>drwxr-xr-x. 1 root root  1700 Apr 29 09:34  .
drwxr-xr-x. 1 root root   190 Mar 18 10:38  ..
-rw-r--r--. 1 root root   243 Feb  7 17:08  404.html
-rw-r--r--. 1 root root  1390 Feb  7 17:08  .all-contributorsrc
drwxr-xr-x. 1 root root    58 Feb  7 17:08  assets
drwxr-xr-x. 1 root root    20 Feb  7 17:08  _bibliography
drwxr-xr-x. 1 root root   126 Feb  7 17:08  bin
drwxr-xr-x. 1 root root    20 Feb  7 17:08  blog
</code></pre></div></div> <p>Notice that inside the container, the owner of the files is <code class="language-plaintext highlighter-rouge">root</code> (<code class="language-plaintext highlighter-rouge">uid=0</code>). This is because in a rootless container environment, user IDs from the container are mapped to user IDs on your host machine. This is not ideal!</p> <h2 id="mapping-user-ids-in-rootless-containers">Mapping User IDs in Rootless Containers</h2> <p>We need to map the root user inside the container to our non-root user (<code class="language-plaintext highlighter-rouge">alpha</code>) on the host. This means that when a process inside the container runs as root, it’s actually running as the user <em>alpha</em> on the host.</p> <p>First, let’s find our user’s ID on the host:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">id</span> <span class="nt">-u</span>
</code></pre></div></div> <p>It should return <code class="language-plaintext highlighter-rouge">1000</code>.</p> <p>Next, check the user range applied for your user with the following:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>podman unshare <span class="nb">cat</span> /proc/self/uid_map
</code></pre></div></div> <p>The output should look similar to this:</p> <div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>0       1000          1
1     100000      65536
</code></pre></div></div> <p>This tells us the user ID mapping:</p> <ul> <li> <code class="language-plaintext highlighter-rouge">uid 0</code> inside the container maps to <code class="language-plaintext highlighter-rouge">uid 1000</code> on the host (our non-root user).</li> <li> <code class="language-plaintext highlighter-rouge">uid 1</code> inside the container maps to <code class="language-plaintext highlighter-rouge">uid 100000</code> on the host, and so on.</li> </ul> <p>To use a different user inside our container, with an arbitrary uid, let’s say 1000, we need to map this uid inside the container to the range of allowed uids in our host. Thus, we need to set the owner of the files inside the container to <code class="language-plaintext highlighter-rouge">1000:1000</code> which will be mapped to an allowed user in our host.</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>podman unshare <span class="nb">chown </span>1000:1000 <span class="nt">-R</span> <span class="nb">.</span>
</code></pre></div></div> <p>Let’s check what we have now, by running:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">ls</span> <span class="nt">-al</span>
</code></pre></div></div> <div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>drwxr-xr-x. 1 100999 100999  1518 Apr 29 10:04 .
drwxr-xr-x. 1 alpha  alpha     44 Mar 25 08:08 ..
-rw-r--r--. 1 100999 100999   243 Feb  7 17:08 404.html
-rw-r--r--. 1 100999 100999  1390 Feb  7 17:08 .all-contributorsrc
drwxr-xr-x. 1 100999 100999    58 Feb  7 17:08 assets
drwxr-xr-x. 1 100999 100999    20 Feb  7 17:08 _bibliography
drwxr-xr-x. 1 100999 100999   126 Feb  7 17:08 bin
drwxr-xr-x. 1 100999 100999    20 Feb  7 17:08 blog
</code></pre></div></div> <p>and by running this command in the unshare context</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>podman unshare <span class="nb">ls</span> <span class="nt">-al</span>
</code></pre></div></div> <div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>drwxr-xr-x. 1 alpha alpha  1518 Apr 29 10:04 .
drwxr-xr-x. 1 root  root     44 Mar 25 08:08 ..
-rw-r--r--. 1 alpha alpha   243 Feb  7 17:08 404.html
-rw-r--r--. 1 alpha alpha  1390 Feb  7 17:08 .all-contributorsrc
drwxr-xr-x. 1 alpha alpha    58 Feb  7 17:08 assets
drwxr-xr-x. 1 alpha alpha    20 Feb  7 17:08 _bibliography
drwxr-xr-x. 1 alpha alpha   126 Feb  7 17:08 bin
drwxr-xr-x. 1 alpha alpha    20 Feb  7 17:08 blog
</code></pre></div></div> <p>Notice how the owners are different depending on if the command is run under the unshare context or not.</p> <h2 id="running-jekyll-with-podman-compose">Running Jekyll with podman-compose</h2> <p>Now that we have set up the file ownership, we can run our Jekyll container. We will use <code class="language-plaintext highlighter-rouge">podman-compose</code>. First, let’s open our <code class="language-plaintext highlighter-rouge">docker-compose</code> file to understand the definition of the jekyll service:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>emacs docker-compose-project-podman.yml
</code></pre></div></div> <p>Once you understand how the service is defined, let’s run the container:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>podman-compose <span class="nt">-f</span> docker-compose-project-podman.yml up
</code></pre></div></div> <p>This command starts the Jekyll service defined in your compose file.</p> <p>To shut down the service, use:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>podman-compose <span class="nt">-f</span> docker-compose-project-podman.yml down
</code></pre></div></div> <h2 id="reverting-file-ownership">Reverting File Ownership</h2> <p>After running your container, it’s important to revert the file ownership back to your host user:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo chown </span>alpha:alpha <span class="nt">-R</span> <span class="nb">.</span>
</code></pre></div></div> <p>Check if everything is correct by running <code class="language-plaintext highlighter-rouge">ls -al</code>:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">ls</span> <span class="nt">-al</span>
</code></pre></div></div> <div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>drwxr-xr-x. 1 alpha alpha  1700 Apr 29 09:34  .
drwxr-xr-x. 1 alpha alpha   190 Mar 18 10:38  ..
-rw-r--r--. 1 alpha alpha   243 Feb  7 17:08  404.html
-rw-r--r--. 1 alpha alpha  1390 Feb  7 17:08  .all-contributorsrc
drwxr-xr-x. 1 alpha alpha    58 Feb  7 17:08  assets
drwxr-xr-x. 1 alpha alpha    20 Feb  7 17:08  _bibliography
drwxr-xr-x. 1 alpha alpha   126 Feb  7 17:08  bin
drwxr-xr-x. 1 alpha alpha    20 Feb  7 17:08  blog
</code></pre></div></div> <p>And finally, let’s confirm that the user inside the container will be root, by running the command within the podman context:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>podman unshare <span class="nb">ls</span> <span class="nt">-al</span>
</code></pre></div></div> <div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>drwxr-xr-x. 1 root root  1700 Apr 29 09:34  .
drwxr-xr-x. 1 root root   190 Mar 18 10:38  ..
-rw-r--r--. 1 root root   243 Feb  7 17:08  404.html
-rw-r--r--. 1 root root  1390 Feb  7 17:08  .all-contributorsrc
drwxr-xr-x. 1 root root    58 Feb  7 17:08  assets
drwxr-xr-x. 1 root root    20 Feb  7 17:08  _bibliography
drwxr-xr-x. 1 root root   126 Feb  7 17:08  bin
drwxr-xr-x. 1 root root    20 Feb  7 17:08  blog
</code></pre></div></div> <p>That’s it for now. In the next part we will delve into how to run and test your blog with a rootless container in a reproducible way.</p> <hr> <p><em>This is Part 1 of a series on using rootless Podman containers with Jekyll.</em></p> </div> </article> </div> </div> <footer class="fixed-bottom"> <div class="container mt-0"> © Copyright 2025 Carl Johan Rehn. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="/allehanda/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@4/imagesloaded.pkgd.min.js"></script> <script defer src="/allehanda/assets/js/masonry.js" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.0.8/dist/medium-zoom.min.js" integrity="sha256-7PhEpEWEW0XXQ0k6kQrPKwuoIomz8R8IYyuU1Qew4P8=" crossorigin="anonymous"></script> <script defer src="/allehanda/assets/js/zoom.js?7b30caa5023af4af8408a472dc4e1ebb"></script> <script defer src="https://unpkg.com/bootstrap-table@1.22.1/dist/bootstrap-table.min.js"></script> <script src="/allehanda/assets/js/no_defer.js?d633890033921b33e0ceb13d22340a9c"></script> <script defer src="/allehanda/assets/js/common.js?acdb9690d7641b2f8d40529018c71a01"></script> <script defer src="/allehanda/assets/js/copy_code.js?9b43d6e67ddc7c0855b1478ee4c48c2d" type="text/javascript"></script> <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script> <script async src="https://badge.dimensions.ai/badge.js"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js"></script> <script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script type="text/javascript">function progressBarSetup(){"max"in document.createElement("progress")?(initializeProgressElement(),$(document).on("scroll",function(){progressBar.attr({value:getCurrentScrollPosition()})}),$(window).on("resize",initializeProgressElement)):(resizeProgressBar(),$(document).on("scroll",resizeProgressBar),$(window).on("resize",resizeProgressBar))}function getCurrentScrollPosition(){return $(window).scrollTop()}function initializeProgressElement(){let e=$("#navbar").outerHeight(!0);$("body").css({"padding-top":e}),$("progress-container").css({"padding-top":e}),progressBar.css({top:e}),progressBar.attr({max:getDistanceToScroll(),value:getCurrentScrollPosition()})}function getDistanceToScroll(){return $(document).height()-$(window).height()}function resizeProgressBar(){progressBar.css({width:getWidthPercentage()+"%"})}function getWidthPercentage(){return getCurrentScrollPosition()/getDistanceToScroll()*100}const progressBar=$("#progress");window.onload=function(){setTimeout(progressBarSetup,50)};</script> </body> </html>